nextflow_pipeline {
    name "genome_indexes"
    script "main.nf"

    test("genome_star_build_index") {
        tag "genome_star_build_index"
        tag "test"
        when {
            params {
                outdir = "$outputDir"
                only_genome = true
                save_reference = true
                target_genome_index = null
            }
        }

        then {
            assert workflow.success

            assert new File("$outputDir/00_genome/index/star/SAindex").exists()
        }
    }

    test("genome_bt_build_index") {
        tag "genome_bt_build_index"
        tag "test"
        when {
            params {
                outdir = "$outputDir"
                only_genome = true
                save_reference = true
                smrna_genome_index = null
            }
        }

        then {
            assert workflow.success

            assert new File("$outputDir/00_genome/index/bowtie/homosapiens_smallRNA.1.ebwt").exists()
        }
    }
}
