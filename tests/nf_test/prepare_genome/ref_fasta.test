nextflow_pipeline {
    name "prepare_genome_fasta"
    script "main.nf"

    test("fasta_raw") {
        tag "fasta_raw"
        tag "test"
        when {
            params {
                outdir = "$outputDir"
                only_genome = true
                save_reference = true
                fasta = "s3://ngi-igenomes/igenomes/Saccharomyces_cerevisiae/Ensembl/R64-1-1/Sequence/WholeGenomeFasta/genome.fa"
            }
        }

        then {
            assert workflow.success

            // Test fai created as we did not supply one
            assert new File("$outputDir/00_genome/genome.fa.fai").exists()
        }
    }

    test("fasta_gz") {
        tag "fasta_gz"
        tag "test"
        when {
            params {
                outdir = "$outputDir"
                only_genome = true
                save_reference = true
                fasta = "/Users/cheshic/dev/test_data/clipseq/genome.fa.gz"
            }
        }

        then {
            assert workflow.success

            // Test fai created as we did not supply one
            assert new File("$outputDir/00_genome/genome.fa.fai").exists()
        }
    }

    test("fasta_fai") {
        tag "fasta_fai"
        tag "test"
        when {
            params {
                outdir = "$outputDir"
                only_genome = true
                save_reference = true
                fasta_fai = "/Users/cheshic/dev/test_data/clipseq/genome.fa.fai"
            }
        }

        then {
            assert workflow.success

            // Check fai does not exist as the process should not have run to generate it
            assert !(new File("$outputDir/00_genome/genome.fa.fai").exists())
        }
    }

    test("smrna_fasta_gz") {
        tag "smrna_fasta_gz"
        tag "test"
        when {
            params {
                outdir = "$outputDir"
                only_genome = true
                save_reference = true
                smrna_fasta = "/Users/cheshic/dev/test_data/clipseq/homosapiens_smallRNA.fa.gz"
            }
        }

        then {
            assert workflow.success

            assert new File("$outputDir/00_genome/homosapiens_smallRNA.fa.fai").exists()
        }
    }

    test("genome_smrna_fasta") {
        tag "genome_smrna_fasta"
        tag "test"
        when {
            params {
                outdir = "$outputDir"
                only_genome = true
                save_reference = true
                smrna_fasta = "/Users/cheshic/dev/test_data/clipseq/homosapiens_smallRNA.fa"
            }
        }

        then {
            assert workflow.success

            assert new File("$outputDir/00_genome/homosapiens_smallRNA.fa.fai").exists()
        }
    }

    test("genome_smrna_fasta_fai") {
        tag "genome_smrna_fasta_fai"
        tag "test"
        when {
            params {
                outdir = "$outputDir"
                only_genome = true
                save_reference = true
                fasta_fai = "/Users/cheshic/dev/test_data/clipseq/homosapiens_smallRNA.fa.fai"
            }
        }

        then {
            assert workflow.success

            // Check fai does not exist as the process should not have run to generate it
            assert !(new File("$outputDir/00_genome/homosapiens_smallRNA.fa.fai").exists())
        }
    }
}
